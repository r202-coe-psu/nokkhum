__BRYTHON__.use_VFS = true;
var scripts = {"$timestamp": 1621841026113, "gridviews": [".py", "from . import controllers\n\n__all__=[\"controllers\"]\n", ["gridviews"], 1], "gridviews.controllers": [".py", "from browser import document,html,ajax\nfrom javascript import JSON\n\n\nclass GridViewController:\n def __init__(self,num_grids=\"4\",save_gird_url=\"\",get_grid_url=\"\"):\n  self.num_grids=num_grids\n  self.save_gird_url=save_gird_url\n  self.get_grid_url=get_grid_url\n  \n def mouseover(self,ev):\n  ev.target.style.cursor=\"pointer\"\n  \n def dragstart_img(self,ev):\n  data=ev.target.id[4:]\n  print(data)\n  ev.dataTransfer.setData(\"text\",data)\n  ev.dataTransfer.effectAllowed=\"move\"\n  \n def dragstart(self,ev):\n  ev.dataTransfer.setData(\"text\",ev.target.id)\n  ev.dataTransfer.effectAllowed=\"move\"\n  \n def dragover(self,ev):\n  ev.dataTransfer.dropEffect=\"move\"\n  ev.preventDefault()\n  \n def clear_display(self,ev):\n  ev.target.unbind(\"click\")\n  ev.target.parent.unbind(\"dragstart\")\n  ev.target.parent.clear()\n  \n def drop(self,ev):\n  ''\n\n\n  \n  \n  src=ev.dataTransfer.getData(\"text\")\n  camera=document[src]\n  camera_id,url=src.split(\"-\")\n  display=document[ev.target.id]\n  try :\n   document[f\"img-{src}\"].unbind(\"dragstart\")\n   document[f\"img-{src}\"].parent.clear()\n   \n  except Exception as e:\n   pass\n  img=html.IMG(\n  id=f\"img-{src}\",\n  src=url,\n  height=\"100%\",\n  )\n  btn=html.A(\n  \"Clear\",\n  Class=\"clear-btn ui button\",\n  )\n  display.clear()\n  display <=img\n  display <=btn\n  img.draggable=True\n  btn.bind(\"click\",self.clear_display)\n  img.bind(\"dragstart\",self.dragstart_img)\n  \n  ev.preventDefault()\n  \n def save_grid(self,ev):\n  def on_complete(req):\n   if req.status ==200:\n    print(req.text)\n   else :\n    print(\"error \",req.text)\n    \n  displays=document.select(\".displays\")\n  displays_data={}\n  for display in displays:\n   displays_data[display.id]=display.innerHTML\n   \n  ajax.post(\n  self.save_gird_url,\n  data={\n  \"displays\":JSON.stringify(displays_data),\n  \"num_grids\":self.num_grids,\n  },\n  oncomplete=on_complete,\n  headers={\"Content-Type\":\"application/x-www-form-urlencoded\"},\n  )\n  \n def initial_grid(self,req):\n  displays_data=JSON.parse(req.text)\n  for id,img_html in displays_data.items():\n   if not img_html:\n    continue\n   print(img_html)\n   \n   document[id].innerHTML=img_html\n   for child in document[id].children:\n    child.bind(\"dragstart\",self.dragstart_img)\n  for clear_btn in document.select(\".clear-btn\"):\n   clear_btn.bind(\"click\",self.clear_display)\n   \n def start(self):\n  print(\"start\")\n  for camera in document.select(\".cameras\"):\n   camera.bind(\"mouseover\",self.mouseover)\n   camera.bind(\"dragstart\",self.dragstart)\n   \n  for display in document.select(\".displays\"):\n   display.bind(\"dragover\",self.dragover)\n   display.bind(\"drop\",self.drop)\n   \n  document[\"save-grid\"].bind(\"click\",self.save_grid)\n  \n  ajax.get(\n  f\"{self.get_grid_url}?grid={self.num_grids}\",\n  oncomplete=self.initial_grid,\n  )\n", ["browser", "javascript"]]}
__BRYTHON__.update_VFS(scripts)
